# Исполнение

Система исполнения Namada ledger основана на начальной версии модели исполнения Anoma. В системе реализована общая вычислительная подложка с транзакциями на основе WASM и проверкой предикатов достоверности. Именно на ней построены такие специфические возможности Namada, как IBC, proof-of-stake и MASP.

### Предикат валидности(VP)

Концептуально предикат достоверности представляет собой булеву функцию, которая проверяет четыре параметра:

1. Сама транзакция (отдельные части транзакции иногда анализируются в логике VP)
2. Адреса, относящиеся к данному конкретному VP
3. Состояние хранилища перед выполнением транзакции
4. Состояние хранилища после выполнения транзакции

Транзакция может модифицировать любые данные в подпространстве динамического хранения счетов. При выполнении транзакции вызываются VP, связанные со счетами, хранилища которых были модифицированы, для проверки транзакции. Если кто-то из них отклоняет транзакцию, то все модификации хранилища отбрасываются, если все соглашаются, то модификации хранилища записываются.

### Namada ledger

Namada ledger построена на основе интерфейса ABCI CometBFT с небольшим отклонением от стандарта ABCI: в Namada транзакции в настоящее время выполняются не методом DeliverTx, а методом EndBlock ABCI. Это сделано с целью подготовки к будущей интеграции DKG и пороговой дешифрации.

В ledger используется система, основанная на счетах (в которой системы на базе UTXO, такие как MASP, могут быть внутренне реализованы как конкретные счета), где каждый счет имеет уникальный адрес и динамическое подпространство для хранения ключей-значений. Каждый счет в Namada связан ровно с одним предикатом достоверности. Например, сгораемые токены являются счетами, правила которых определяются их предикатами достоверности. Многие из указанных здесь базовых подсистем Namada ledger сами являются специальными счетами Namada (например, PoS, IBC и MASP). Эта модель в целом похожа на модель Ethereum, где каждый счет связан с кодом контракта, но отличается моделью исполнения.

Взаимодействие с Namada ledger осуществляется посредством транзакций. В Namada транзакции могут произвольно модифицировать хранилище любого счета, но транзакция будет принята и изменения состояния применены только в том случае, если все предикаты достоверности, которые были вызваны транзакцией, примут ее. То есть все счета, чьи подпространства хранения были затронуты транзакцией, будут иметь предикаты достоверности, подтверждающие транзакцию. Транзакция также может явно выбрать какой-либо счет в качестве верификатора данной транзакции, в результате чего будет задействован его предикат достоверности. Транзакция может добавить любое количество дополнительных верификаторов, но не может удалить те, которые определены протоколом. Например, при передаче прозрачного взаимозаменяемого токена обычно срабатывают 3 предиката достоверности - токена, адреса источника и адреса получателя.

Namada ledger знает, какие адреса участвуют в транзакции WASM, благодаря тому, как построено хранилище. Каждая переменная в хранилище по своей природе привязана к подхранилищу, принадлежащему некоторому счету, и, соответственно, вызывается нужный VP.

### Поддерживаемые предикаты валидности&#x20;

Хотя модель исполнения полностью программируема, для Namada только избранное подмножество поддерживаемых предикатов достоверности и транзакций будет разрешено через предварительно созданные белые списки, настраиваемые при запуске сети.

Существует несколько собственных VP для внутренних прозрачных адресов, которые встроены в Namada ledger. Все остальные VP реализованы в виде WASM-программ. Можно создать собственный VP, используя шаблон VP, или воспользоваться одним из предопределенных VP.

Поддерживаемые предикаты достоверности для Namada:

* Собственные
  * Proof-of-stake&#x20;
  * Мост Ethereum
  * IBC & IbcToken
  * Управление
  * Параметры протокола (часть управления)
  * Мультитокены
* WASM
  * MASP
  * k-of-n мультиподпись
