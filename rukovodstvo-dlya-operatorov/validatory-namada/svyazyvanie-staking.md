# Связывание (Staking)

Мы обсуждаем два типа связей:

1. Несамостоятельное связывание (называемое делегированием во многих других экосистемах, но не путать с делегированием управления на Namada)
2. Самосвязывание

### Несамостоятельное связывание (делегирование)

Пользователи могут связываться с любым количеством валидаторов в любое время. Когда пользователь связывает токены, они не будут засчитываться в долю валидатора (которая, в свою очередь, определяет его право голоса) до начала эпохи n + 2 в текущей эпохе n (литера 2 задается PoS-параметром pipeline\_len). Связанные токены будут немедленно списаны со счета валидатора и зачислены на счет PoS-системы.

Для связывания токенов с адреса источника с псевдонимом aliace на валидатор с псевдонимом validator-1:

```rust
namada client bond \
  --source aliace \
  --validator validator-1 \
  --amount 12.34
```

Вы можете запросить информацию о своих связанных токенах:

```rust
namada client bonds --owner aliace
```

Результат этого запроса сообщит эпоху, начиная с которой ваши связанные токены будут активны.

Поскольку система PoS - это всего лишь счет, можно запросить его баланс, который представляет собой сумму всех токенов, связанных в данный момент, а также токенов, которые еще не были выведены:

```rust
namada client balance --owner PoS
```

### Самостоятельное связывание

Также существует возможность увеличить право голоса валидатора путем связывания NAM с ликвидного баланса валидатора с самим собой. Пользователь может отправить транзакцию самосвязывания токенов со счета валидатора в систему PoS:

```rust
namada client bond \
  --validator my-validator \
  --amount 3.3
```

### Запрос связанного пакета валидатора

Облигационный пакет (право голоса в cometbft) валидатора определяется суммой всех его активных связанных токенов и токенов делегатов, с применением slashes если таковые имеются.

При разблокировке токенов сумма токенов не засчитывается в ставку валидатора до начала эпохи n + 2 в текущей эпохе n. Сумма токенов немедленно списывается со счета валидатора и зачисляется на счет PoS-системы.

Чтобы увидеть всех валидаторов и их право голоса, которое в точности равно количеству поставленных токенов NAM от их токенов и делегированных токенов, можно сделать запрос:

```rust
namada client bonded-stake
```

В этой команде можно указать параметр `--epoch`, чтобы найти значения голосов в некоторую будущую эпоху. Обратите внимание, что окончательными являются только значения голосов для текущей и следующей эпохи.

### Slashes

Если валидатор проявляет наказуемое поведение, то токены, относящиеся к этому валидатору, также подлежат уничтожению. Только те токены, которые были активны в эпоху, в которой произошла ошибка, будут срезаны по коэффициенту, соответствующему типу ошибки. Если какие-либо из ваших токенов подверглись слэшингу, это будет отображено в запросе токенов. Вы также можете найти все примененные слеши с помощью функции:

```rust
namada client slashes
```

### Разблокировка

Пока токены связаны, они заблокированы в системе PoS и, следовательно, не являются ликвидными до тех пор, пока бондер их не изымет. Для этого бондеру необходимо отправить транзакцию на "развязывание" своих токенов. Пользователь может разблокировать любое количество, вплоть до суммы всех своих токенов у данного валидатора, даже до того, как токены станут активными.

#### Несамостоятельное разблокирование

Подача валидатору заявки на открепление токенов:

```rust
namada client unbond \
  --source aliace \
  --validator validator-1 \
  --amount 1.2
```

#### Саморазвязывание

Для подачи заявки на открепление токенов от валидатора:

```rust
namada client unbond \
  --validator my-validator \
  --amount 0.3

```

### Вывод токенов

Когда пользователь отвязывает токены, он не сможет вывести их сразу. Вместо этого токены, развязанные в эпоху n, будут доступны для снятия, начиная с эпохи n + 6 (литера 6 задается PoS-параметром `unbonding_len`). После того как токены будут разблокированы, пользователь сможет узнать, когда он сможет их изъять, с помощью запроса bonds:

```rust
namada client bonds --owner aliace
```

Когда цепочка достигнет эпохи, в которой можно будет вывести токены (или в любое другое время после этого), `aliace` сможет подать заявку на вывод не привязанных токенов обратно на свой счет:

```rust
namada client withdraw \  --source aliace \  --validator validator-1
```

В случае успеха выведенные токены будут зачислены на счет aliace и списаны с системы PoS.
